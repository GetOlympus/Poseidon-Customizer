!function(l){function o(e,t){var o=this;o.options=t,o.$el=e,o.id=o.getUuid(),o.options.init="pos-cp--init",o.options.opened="pos-cp--opened",o.options.hidden="pos-cp--none",o.options.sizes={},o._initialize()}o.prototype.$colorpicker=null,o.prototype.$container=null,o.prototype.$el=null,o.prototype.$output=null,o.prototype.$saturation=null,o.prototype.$hue=null,o.prototype.$alpha=null,o.prototype.$pointers=null,o.prototype.$inputs=null,o.prototype.$preview=null,o.prototype.areas={},o.prototype.id="",o.prototype.maincolor="",o.prototype.options=null,o.prototype.picking=!1,o.prototype._initialize=function(){var e=this;e.$container=l(e.options.container),e.$container.length?1<e.$container.length&&(e.$container=e.$container.eq(0)):(e.options.container="body",e.$container=l(e.options.container)),e.maincolor=e.options.defaultColor,e._initColorPicker(),e._initComponents(),e._initDefaultColor(),e._initSwatches(),e._initEvents(),document.poseidonColorPicker={id:e.id,this:e}},o.prototype._initColorPicker=function(){var e=this,t={id:e.id,options:{alpha:"pos-cp--alpha-"+(e.options.alpha?"enabled":"disabled"),hue:"pos-cp--hue-"+(e.options.hue?"enabled":"disabled"),preview:"pos-cp--preview-"+(e.options.preview?"enabled":"disabled"),saturation:"pos-cp--saturation-"+(e.options.saturation?"enabled":"disabled"),toggle:"pos-cp--toggle-"+(e.options.toggleButtons?"enabled":"disabled"),inline:"pos-cp--inline-"+(e.options.inline?"enabled":"disabled")},color:e.maincolor,pointers:{alpha:"left:0",hue:"left:0",saturation:"left:0; top:0"},icon:'<i class="dashicons dashicons-leftright"></i>',labels:{hex:"hex",rgb:"rgb",hsl:"hsl",alpha:"a"}},t=(e.$colorpicker=l(document.createElement("component")).attr({id:t.id,class:"poseidon-color-picker "+Object.values(t.options).join(" "),style:"color:"+t.color}),'<input aria-label="output" type="hidden" readonly="readonly" disabled /><main role="saturationPanel" class="pos-cp-saturation">'+` <span role="saturationPicker" class="pos-cp-pointer" style="${t.pointers.saturation}" x="0" y="0"></span>`+'</main><nav class="pos-cp-swatches"></nav><section class="pos-cp-sliders"> <div role="huePanel" class="pos-cp-hue">'+`  <span role="huePicker" class="pos-cp-pointer" style="${t.pointers.hue}" x="0" y="0"></span>`+' </div> <div role="alphaPanel" class="pos-cp-alpha">'+`  <span role="alphaPicker" class="pos-cp-pointer" style="${t.pointers.alpha}" x="0" y="0"></span>`+' </div></section><section class="pos-cp-fields"> <div class="pos-cp-inputs pos-cp--hex">  <input aria-label="hex" class="pos-cp-input--value" readonly="readonly" disabled />'+`  <span class="pos-cp-input--label">${t.labels.hex} ${t.icon}</span>`+' </div> <div class="pos-cp-inputs pos-cp--rgb pos-cp--none">  <input aria-label="r" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="g" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="b" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="a" class="pos-cp-input--value" readonly="readonly" disabled />'+`  <span class="pos-cp-input--label">${t.labels.rgb}<b>${t.labels.alpha}</b> ${t.icon}</span>`+' </div> <div class="pos-cp-inputs pos-cp--hsl pos-cp--none">  <input aria-label="h" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="s" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="l" class="pos-cp-input--value" readonly="readonly" disabled />  <input aria-label="a" class="pos-cp-input--value" readonly="readonly" disabled />'+`  <span class="pos-cp-input--label">${t.labels.hsl}<b>${t.labels.alpha}</b> ${t.icon}</span>`+" </div>"+` <aside class="pos-cp-preview" style="color:${t.color};"></aside>`+"</section>");e.$colorpicker.append(t)},o.prototype._initComponents=function(){var e=this;e.$output=e.$colorpicker.find('> input[type="hidden"]'),e.$saturation=e.$colorpicker.find("main.pos-cp-saturation"),e.$hue=e.$colorpicker.find("div.pos-cp-hue"),e.$alpha=e.$colorpicker.find("div.pos-cp-alpha"),e.$pointers=e.$colorpicker.find("span.pos-cp-pointer"),e.$inputs=e.$colorpicker.find("input.pos-cp-input--value"),e.$labels=e.$colorpicker.find("span.pos-cp-input--label"),e.$preview=e.$colorpicker.find("aside.pos-cp-preview")},o.prototype._initDefaultColor=function(){this.maincolor=this.getColor()},o.prototype._initEvents=function(){var e=this;e.$colorpicker.on("destroy",l.proxy(e.eventDestroyColorPicker,e)),e.$el.on("click",l.proxy(e.eventClickElement,e)),e.$output.on("input",l.proxy(e.eventChangeOutput,e)),e.$labels.on("click",l.proxy(e.eventClickLabel,e))},o.prototype._initSwatches=function(){var o=this,n=o.options.swatches.length;if(n){var e=o.$colorpicker.find(".pos-cp-swatches");let t="";for(let e=0;e<n;e++)t+='<button class="pos-cp-swatch" style="color:__COLOR__;"></button>'.replace("__COLOR__",o.options.swatches[e]);""!==t&&(e.append(t),e.find("button.pos-cp-swatch").on("click",l.proxy(o.eventClickSwatch,o)))}},o.prototype.getColor=function(){var e=this,t=e.$el.attr("value");return void 0!==t&&!1!==t?t:(t=e.$el.find("input")).length?t.attr("value"):e.maincolor},o.prototype.getElement=function(e,t="hex"){let o=0;return("pointer"===e?(o="hue"===t?1:"alpha"===t?2:0,this.$pointers):(names="rgbahslz",o="hex"!==t?names.indexOf(t)+1:0,this.$inputs))[o]},o.prototype.getPointerPosition=function(e){return{x:(e.changedTouches?e.changedTouches[0]:e).pageX,y:(e.changedTouches?e.changedTouches[0]:e).pageY}},o.prototype.getRole=function(e){e=l(e.currentTarget).attr("role");return"saturationPanel"===e?"saturation":e.replace(/(Picker|Panel)/g,"")},o.prototype.getUuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},o.prototype.setColorFromPosition=function(){var e=this,t={h:360*e.getElement("pointer","hue").getAttribute("x")/e.areas.width,s:100*e.getElement("pointer","saturation").getAttribute("x")/e.areas.width,v:100-100*e.getElement("pointer","saturation").getAttribute("y")/e.areas.height,a:100*e.getElement("pointer","alpha").getAttribute("x")/e.areas.width/100},o=e.hsv2rgb(t);e.maincolor=`rgba(${o.r}, ${o.g}, ${o.b}, ${o.a})`,e.updateColor(o,t)},o.prototype.setPositionFromColor=function(){var e=this,t=e.str2rgb(e.maincolor,e.options),o=e.rgb2hsv(t),n={saturation:{x:e.areas.width*o.s/100,y:e.areas.height-e.areas.height*o.v/100},hue:{x:o.h*e.areas.width/360},alpha:{x:o.a*e.areas.width}};e.getElement("pointer","saturation").style.left=n.saturation.x+"px",e.getElement("pointer","saturation").style.top=n.saturation.y+"px",e.getElement("pointer","hue").style.left=n.hue.x+"px",e.getElement("pointer","alpha").style.left=n.alpha.x+"px",e.getElement("pointer","saturation").setAttribute("x",n.saturation.x),e.getElement("pointer","saturation").setAttribute("y",n.saturation.y),e.getElement("pointer","hue").setAttribute("x",n.hue.x),e.getElement("pointer","alpha").setAttribute("x",n.alpha.x),e.updateColor(t,o)},o.prototype.updateColor=function(e={},t={}){var o=this,n=o.rgb2hex(e,o.options),i=n.substring(0,7),a=`hsl(${t.h}, 100%, 50%)`,a=(o.$colorpicker.css("color",a),o.getElement("pointer","hue").style.color=a,o.getElement("pointer").style.color=i,o.$alpha.css("color",i),o.getElement("pointer","alpha").style.color=n,o.$preview.css("color",n),o.hsv2hsl(t));o.getElement("input","hex").value=n,o.getElement("input","r").value=Math.round(e.r),o.getElement("input","g").value=Math.round(e.g),o.getElement("input","b").value=Math.round(e.b),o.getElement("input","a").value=Math.round(100*(e.a+Number.EPSILON))/100,o.getElement("input","h").value=Math.round(a.h),o.getElement("input","s").value=Math.round(a.s),o.getElement("input","l").value=Math.round(a.l),o.getElement("input","z").value=Math.round(100*(a.a+Number.EPSILON))/100,o.updateOutput()},o.prototype.updateColorPickerPosition=function(){var a=this,r=a.$colorpicker[0].getBoundingClientRect(),e=window.getComputedStyle(a.$colorpicker[0]);if(!a.options.inline){var p={height:a.$el[0].offsetHeight,width:a.$el[0].offsetWidth};let e={top:0,x:0,y:0},t=window.scrollY,o={height:0,styles:{},top:0,width:0},n=r.x,i=r.y;"body"!==a.options.container?((o={height:a.$container[0].clientHeight,styles:window.getComputedStyle(a.$container[0]),top:a.$container[0].scrollTop,width:a.$container[0].clientWidth}).height-=parseFloat(o.styles.marginTop),(e=a.$container[0].getBoundingClientRect()).y+=parseFloat(o.styles.borderTopWidth)+t,n-=e.x,i-=e.y,e.top=i-r.height+p.height):(o={height:document.documentElement.clientHeight,width:document.documentElement.clientWidth},t=0,e.top=r.y-p.height),n+=n+p.width>o.width?r.width-p.width:0,i+p.height-t>o.height&&(i=p.height<=r.top-e.y-t?e.top:0),i+=o.top,a.$colorpicker.css({left:n+"px",top:i+"px"})}let t=a.$saturation[0];a.options.saturation||(t=(a.options.hue?a.$hue:a.$alpha)[0]),a.areas={height:t.offsetHeight,width:t.offsetWidth,x:r.x+parseFloat(e.paddingLeft),y:r.y+parseFloat(e.paddingTop)}},o.prototype.updateOutput=function(){var e=this,t=e.getElement("input","hex").value,o="rgb",n=(o=(o=(o=(o=(o+=e.options.alpha||e.options.alwaysAlpha?"a":"")+("("+e.getElement("input","r").value))+(","+e.getElement("input","g").value))+(","+e.getElement("input","b").value))+(e.options.alpha||e.options.alwaysAlpha?","+e.getElement("input","a").value:"")+")","hsl"),n=(n=(n=(n=(n+=e.options.alpha||e.options.alwaysAlpha?"a":"")+("("+e.getElement("input","h").value))+(","+e.getElement("input","s").value))+(","+e.getElement("input","l").value))+(e.options.alpha||e.options.alwaysAlpha?","+e.getElement("input","z").value:"")+")";e.maincolor=""===e.maincolor?t:e.maincolor;let i="";i="mixed"===e.options.output?(i=e.options.alpha?o:t,"var("===e.maincolor.substring(0,4).toLowerCase()?e.maincolor:i):"rgb"===e.options.output?o:"hsl"===e.options.output?n:t,e.$output.attr("value",i),e.$output.trigger("input")},o.prototype.eventChangeOutput=function(e){e.preventDefault();var t=this,e=e.currentTarget.value,o=(t.$el.css("color",e),t.$el.find("input"));o.length&&o.attr("value",e),"function"==typeof t.options.onChange&&t.options.onChange.call(this,e,t)},o.prototype.eventClickElement=function(e){e.preventDefault(),e.stopPropagation();var t,e=this;e.$colorpicker.hasClass(e.options.opened)?e.$colorpicker.trigger("destroy"):((t=l(".poseidon-color-picker").not('[id="'+e.id+'"]')).length&&l.each(t,function(e,t){l(t).trigger("destroy")}),e.maincolor=e.getColor(),e.$colorpicker.hasClass(e.options.init)||(e.$container.append(e.$colorpicker),e.$colorpicker.addClass(e.options.init)),e._attach(),e.$colorpicker.addClass(e.options.opened),e.updateColorPickerPosition(),e.setPositionFromColor())},o.prototype.eventClickLabel=function(e){e.preventDefault(),e.stopPropagation();var t=this.$colorpicker.find("div.pos-cp-inputs"),e=(e=e.currentTarget.parentNode.className).replace(/pos-cp-inputs|pos-cp--|\s/gi,"");t.addClass("pos-cp--none"),("hex"===e?t.eq(1):"rgb"===e?t.eq(2):t.eq(0)).removeClass(this.options.hidden)},o.prototype.eventClickSwatch=function(e){e.preventDefault(),e.stopPropagation();let t=e.currentTarget.getAttribute("style").replace(/color:|;/gi,"");"currentcolor"===t.toLowerCase()&&(t=l(e.currentTarget).css("color")),this.maincolor=t,this.setPositionFromColor()},o.prototype.eventDestroyColorPicker=function(){this.$colorpicker.removeClass(this.options.opened),this._detach()},o.prototype.eventMovePointer=function(e){e.preventDefault(),e.stopImmediatePropagation();var t=this,o=document.poseidonColorPicker.role,e=(t.updateColorPickerPosition(),t.getPointerPosition(e)),n=t.getElement("pointer",o),i=(i=e.x-t.areas.x)<0?0:i>t.areas.width?t.areas.width:i;n.style.left=i+"px",n.setAttribute("x",i);"saturation"===o&&(i=e.y-t.areas.y,i=(i+="body"!==t.options.container?t.$container[0].scrollTop:0)<0?0:i>t.areas.height?t.areas.height:i,n.style.top=i+"px",n.setAttribute("y",i)),t.setColorFromPosition()},o.prototype.hsv2rgb=function(e){var t=e.v/100,o=e.s/100*t,n=e.h/60,i=o*(1-Math.abs(n%2-1)),t=t-o,n=(o+=t,i+=t,Math.floor(n)%6),a=Math.round(255*[o,i,t,t,i,o][n]),r=Math.round(255*[i,o,o,i,t,t][n]),t=Math.round(255*[t,t,i,o,o,i][n]);return{r:a,g:r,b:t,a:void 0===e.a?1:e.a,hex:"#"+(16777216|t|r<<8|a<<16).toString(16).slice(1)}},o.prototype.hsv2hsl=function(e){var t=e.v/100,o=t*(1-e.s/100/2);let n=0;return 0<o&&o<1&&(n=Math.round((t-o)/Math.min(o,1-o)*100)),{h:e.h,s:n,l:Math.round(100*o),a:void 0===e.a?1:e.a}},o.prototype.rgb2hex=function(e,t){var o=e.r.toString(16),n=e.g.toString(16),i=e.b.toString(16);let a="";return o=e.r<16?"0"+o:o,n=e.g<16?"0"+n:n,i=e.b<16?"0"+i:i,t.alpha&&(e=255*(void 0===e.a?1:e.a)|0,a=e.toString(16),a="ff"!==(a=e<16?"0"+a:a)||t.alwaysAlpha?a:""),"#"+o+n+i+a},o.prototype.rgb2hsv=function(e){var t=e.r/255,o=e.g/255,n=e.b/255,i=Math.max(t,o,n),a=i-Math.min(t,o,n),r=i;let p=0,l=0;return a&&(p=i===t?(o-n)/a:p,p=i===o?2+(n-t)/a:p,p=i===n?4+(t-o)/a:p,l=i?a/i:l),{h:(p=Math.floor(60*p))<0?p+360:p,s:Math.round(100*l),v:Math.round(100*r),a:void 0===e.a?1:e.a}},o.prototype.str2rgb=function(e,t){"var("===e.substring(0,4).toLowerCase()&&(i=/^var\(([a-zA-Z0-9-]{1,})(.*)\)/i.exec(e),e=getComputedStyle(document.documentElement).getPropertyValue(i[1]));let o,n;var i=document.createElement("canvas").getContext("2d");return i.fillStyle="#000000",i.fillStyle=e,o=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i.exec(i.fillStyle),n=o?{r:+o[3],g:+o[4],b:+o[5],a:t.alpha?+o[6]:1}:{r:(o=i.fillStyle.replace("#","").match(/.{2}/g).map(e=>parseInt(e,16)))[0],g:o[1],b:o[2],a:1}},o.prototype._attach=function(){function e(e){document.poseidonColorPicker.role=a.getRole(e),o[document.poseidonColorPicker.role].on("mouseenter",n),o[document.poseidonColorPicker.role].on("mouseleave",i),o[document.poseidonColorPicker.role].on("mousemove",r),o[document.poseidonColorPicker.role].on("mouseup",p),a.eventMovePointer(e)}var a=this,t=l(document),o={alpha:a.$alpha,hue:a.$hue,saturation:a.$saturation};const n=function(e){t.off("mousemove",r),t.off("mouseup",p),o[document.poseidonColorPicker.role].on("mousemove",r),o[document.poseidonColorPicker.role].on("mouseup",p),a.eventMovePointer(e)},i=function(e){o[document.poseidonColorPicker.role].off("mousemove",r),o[document.poseidonColorPicker.role].off("mouseup",p),t.on("mousemove",r),t.on("mouseup",p),a.eventMovePointer(e)},r=function(e){a.eventMovePointer(e)},p=function(e){o[document.poseidonColorPicker.role].off("mouseenter",n),o[document.poseidonColorPicker.role].off("mouseleave",i),o[document.poseidonColorPicker.role].off("mousemove",r),o[document.poseidonColorPicker.role].off("mouseup",p),t.off("mousemove",r),t.off("mouseup",p),a.eventMovePointer(e),document.poseidonColorPicker.role=null};a.$saturation.on("mousedown",e),a.$hue.on("mousedown",e),a.$alpha.on("mousedown",e),a.$preview.one("click",function(e){e.stopPropagation(),a.$colorpicker.trigger("destroy")}),t.one("mousedown",function(e){e.stopPropagation();e=l(e.target);e.closest(".poseidon-color-picker").length||e.hasClass("poseidon-color-picker")||a.$colorpicker.trigger("destroy")}),t.on("keydown",function(e){var t,o,n,i=e.key.toLowerCase();"escape"===i?a.$el.trigger("click"):(a.options.saturation||a.options.hue||a.options.alpha)&&(n={arrowup:{x:0,y:-1},arrowdown:{x:0,y:1},arrowleft:{x:-1,y:0},arrowright:{x:1,y:0}},-1!==Object.keys(n).indexOf(i))&&(e.preventDefault(),t=a.options.saturation?"saturation":a.options.hue?"hue":"alpha",e=e.shiftKey?10:1,o=+(t=a.getElement("pointer",t)).getAttribute("x")+n[i].x*e,n=+t.getAttribute("y")+n[i].y*e,o=o<0?0:o>a.areas.width?a.areas.width:o,n=n<0?0:n>a.areas.height?a.areas.height:n,t.style.left=o+"px",t.setAttribute("x",o),t.style.top=n+"px",t.setAttribute("y",n),a.setColorFromPosition())})},o.prototype._detach=function(){this.$saturation.off(),this.$hue.off(),this.$alpha.off()};var t={init:function(e){var t;return!!this.length&&(t={container:"body",alpha:!0,hue:!0,preview:!0,saturation:!0,toggleButtons:!0,alwaysAlpha:!1,defaultColor:"#ff0000",inline:!1,onChange:null,output:"mixed",swatches:[]},this.each(function(){e&&l.extend(t,e),new o(l(this),t)}))}};l.fn.poseidonColorPicker=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(l.error("Method "+e+" does not exist on poseidonColorPicker"),!1):t.init.apply(this,arguments)}}(window.jQuery);