!function(s){function o(t,e){var o=this;o.options=e,o.$el=t,o.id=o.getUuid(),o.options.init="pos-cp--init",o.options.opened="pos-cp--opened",o.options.hidden="pos-cp--none",o.options.element="pos-cp--element",o.options.sizes={},o._initialize()}o.prototype.$colorpicker=null,o.prototype.$container=null,o.prototype.$el=null,o.prototype.$output=null,o.prototype.$saturation=null,o.prototype.$hue=null,o.prototype.$alpha=null,o.prototype.$pointers=null,o.prototype.$inputs=null,o.prototype.$preview=null,o.prototype.areas={},o.prototype.id="",o.prototype.maincolor="",o.prototype.options=null,o.prototype.picking=!1,o.prototype._initialize=function(){var t=this;t.$container=s(t.options.container),t.$container.length?1<t.$container.length&&(t.$container=t.$container.eq(0)):(t.options.container="body",t.$container=s(t.options.container)),t.maincolor=t.options.defaultColor,t._initColorPicker(),t._initComponents(),t._initDefaultColor(),t._initSwatches(),t._initEvents(),document.poseidonColorPicker={id:t.id,this:t}},o.prototype._initColorPicker=function(){var t=this,e={id:t.id,options:{alpha:"pos-cp--alpha-"+(t.options.alpha?"enabled":"disabled"),hue:"pos-cp--hue-"+(t.options.hue?"enabled":"disabled"),preview:"pos-cp--preview-"+(t.options.preview?"enabled":"disabled"),saturation:"pos-cp--saturation-"+(t.options.saturation?"enabled":"disabled"),toggle:"pos-cp--toggle-"+(t.options.toggleButtons?"enabled":"disabled"),inline:"pos-cp--inline-"+(t.options.inline?"enabled":"disabled")},color:t.maincolor,pointers:{alpha:"left:0",hue:"left:0",saturation:"left:0; top:0"},icon:'<i class="dashicons dashicons-leftright"></i>',inputs:t.options.inputs?"":'readonly="readonly" disabled',labels:{hex:"hex",rgb:"rgb",hsl:"hsl",alpha:"a"}},e=(t.$colorpicker=s(document.createElement("component")).attr({id:e.id,class:"poseidon-color-picker "+Object.values(e.options).join(" "),style:"color:"+e.color}),'<input aria-label="output" type="hidden" readonly="readonly" disabled /><main role="saturationPanel" class="pos-cp-saturation">'+` <span role="saturationPicker" class="pos-cp-pointer" style="${e.pointers.saturation}" x="0" y="0"></span>`+'</main><nav class="pos-cp-swatches"></nav><section class="pos-cp-sliders"> <div role="huePanel" class="pos-cp-hue">'+`  <span role="huePicker" class="pos-cp-pointer" style="${e.pointers.hue}" x="0" y="0"></span>`+' </div> <div role="alphaPanel" class="pos-cp-alpha">'+`  <span role="alphaPicker" class="pos-cp-pointer" style="${e.pointers.alpha}" x="0" y="0"></span>`+' </div></section><section class="pos-cp-fields"> <div class="pos-cp-inputs pos-cp--hex">'+`  <input aria-label="hex" class="pos-cp-input--value" ${e.inputs} />`+`  <span class="pos-cp-input--label">${e.labels.hex} ${e.icon}</span>`+' </div> <div class="pos-cp-inputs pos-cp--rgb pos-cp--none">'+`  <input aria-label="r" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="g" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="b" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="a" class="pos-cp-input--value" ${e.inputs} />`+`  <span class="pos-cp-input--label">${e.labels.rgb}<b>${e.labels.alpha}</b> ${e.icon}</span>`+' </div> <div class="pos-cp-inputs pos-cp--hsl pos-cp--none">'+`  <input aria-label="h" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="s" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="l" class="pos-cp-input--value" ${e.inputs} />`+`  <input aria-label="a" class="pos-cp-input--value" ${e.inputs} />`+`  <span class="pos-cp-input--label">${e.labels.hsl}<b>${e.labels.alpha}</b> ${e.icon}</span>`+" </div>"+` <aside class="pos-cp-preview" style="color:${e.color};"></aside>`+"</section>");t.$colorpicker.append(e)},o.prototype._initComponents=function(){var t=this;t.$output=t.$colorpicker.find('> input[type="hidden"]'),t.$saturation=t.$colorpicker.find("main.pos-cp-saturation"),t.$hue=t.$colorpicker.find("div.pos-cp-hue"),t.$alpha=t.$colorpicker.find("div.pos-cp-alpha"),t.$pointers=t.$colorpicker.find("span.pos-cp-pointer"),t.$inputs=t.$colorpicker.find("input.pos-cp-input--value"),t.$labels=t.$colorpicker.find("span.pos-cp-input--label"),t.$preview=t.$colorpicker.find("aside.pos-cp-preview"),t.$el.addClass(t.options.element)},o.prototype._initDefaultColor=function(){this.maincolor=this.getColor()},o.prototype._initEvents=function(){var t=this;t.$colorpicker.on("destroy",s.proxy(t.eventDestroyColorPicker,t)),t.$el.on("click",s.proxy(t.eventClickElement,t)),t.$output.on("input",s.proxy(t.eventChangeOutput,t)),t.$inputs.on("input",s.proxy(t.eventChangeInput,t)),t.$labels.on("click",s.proxy(t.eventClickLabel,t))},o.prototype._initSwatches=function(){var o=this,n=o.options.swatches.length;if(n){var t=o.$colorpicker.find(".pos-cp-swatches");let e="";for(let t=0;t<n;t++)e+='<button class="pos-cp-swatch" style="color:__COLOR__;"></button>'.replace("__COLOR__",o.options.swatches[t]);""!==e&&(t.append(e),t.find("button.pos-cp-swatch").on("click",s.proxy(o.eventClickSwatch,o)))}},o.prototype.getColor=function(){var t=this,e=t.$el.attr("value");return void 0!==e&&!1!==e?e:(e=t.$el.find("input")).length?e.attr("value"):t.maincolor},o.prototype.getElement=function(t,e="hex"){let o=0;return("pointer"===t?(o="hue"===e?1:"alpha"===e?2:0,this.$pointers):(names="rgbahslz",o="hex"!==e?names.indexOf(e)+1:0,this.$inputs))[o]},o.prototype.getPointerPosition=function(t){return{x:(t.changedTouches?t.changedTouches[0]:t).pageX,y:(t.changedTouches?t.changedTouches[0]:t).pageY}},o.prototype.getRole=function(t){t=s(t.currentTarget).attr("role");return"saturationPanel"===t?"saturation":t.replace(/(Picker|Panel)/g,"")},o.prototype.getUuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})},o.prototype.setColorFromPosition=function(){var t=this,e={h:360*t.getElement("pointer","hue").getAttribute("x")/t.areas.width,s:100*t.getElement("pointer","saturation").getAttribute("x")/t.areas.width,v:100-100*t.getElement("pointer","saturation").getAttribute("y")/t.areas.height,a:100*t.getElement("pointer","alpha").getAttribute("x")/t.areas.width/100},o=t.hsv2rgb(e);t.maincolor=`rgba(${o.r}, ${o.g}, ${o.b}, ${o.a})`,t.updateColor(o,e)},o.prototype.setPositionFromColor=function(){var t=this,e=t.str2rgb(t.maincolor,t.options),o=t.rgb2hsv(e),n={saturation:{x:t.areas.width*o.s/100,y:t.areas.height-t.areas.height*o.v/100},hue:{x:o.h*t.areas.width/360},alpha:{x:o.a*t.areas.width}};t.getElement("pointer","saturation").style.left=n.saturation.x+"px",t.getElement("pointer","saturation").style.top=n.saturation.y+"px",t.getElement("pointer","hue").style.left=n.hue.x+"px",t.getElement("pointer","alpha").style.left=n.alpha.x+"px",t.getElement("pointer","saturation").setAttribute("x",n.saturation.x),t.getElement("pointer","saturation").setAttribute("y",n.saturation.y),t.getElement("pointer","hue").setAttribute("x",n.hue.x),t.getElement("pointer","alpha").setAttribute("x",n.alpha.x),t.updateColor(e,o)},o.prototype.updateColor=function(t={},e={}){var o=this,n=o.rgb2hex(t,o.options),i=n.substring(0,7),a=`hsl(${e.h}, 100%, 50%)`,a=(o.$colorpicker.css("color",a),o.getElement("pointer","hue").style.color=a,o.getElement("pointer").style.color=i,o.$alpha.css("color",i),o.getElement("pointer","alpha").style.color=n,o.$preview.css("color",n),o.hsv2hsl(e));o.getElement("input","hex").value=n,o.getElement("input","r").value=Math.round(t.r),o.getElement("input","g").value=Math.round(t.g),o.getElement("input","b").value=Math.round(t.b),o.getElement("input","a").value=Math.round(100*(t.a+Number.EPSILON))/100,o.getElement("input","h").value=Math.round(a.h),o.getElement("input","s").value=Math.round(a.s),o.getElement("input","l").value=Math.round(a.l),o.getElement("input","z").value=Math.round(100*(a.a+Number.EPSILON))/100,o.updateOutput()},o.prototype.updateColorPickerPosition=function(){var a=this,r=a.$colorpicker[0].getBoundingClientRect(),t=window.getComputedStyle(a.$colorpicker[0]);if(!a.options.inline){var p={height:a.$el[0].offsetHeight,width:a.$el[0].offsetWidth};let t={top:0,x:0,y:0},e=window.scrollY,o={height:0,styles:{},top:0,width:0},n=r.x,i=r.y;"body"!==a.options.container?((o={height:a.$container[0].clientHeight,styles:window.getComputedStyle(a.$container[0]),top:a.$container[0].scrollTop,width:a.$container[0].clientWidth}).height-=parseFloat(o.styles.marginTop),(t=a.$container[0].getBoundingClientRect()).y+=parseFloat(o.styles.borderTopWidth)+e,n-=t.x,i-=t.y,t.top=i-r.height+p.height):(o={height:document.documentElement.clientHeight,width:document.documentElement.clientWidth},e=0,t.top=r.y-p.height),n+=n+p.width>o.width?r.width-p.width:0,i+p.height-e>o.height&&(i=p.height<=r.top-t.y-e?t.top:0),i+=o.top,a.$colorpicker.css({left:n+"px",top:i+"px"})}let e=a.$saturation[0];a.options.saturation||(e=(a.options.hue?a.$hue:a.$alpha)[0]),a.areas={height:e.offsetHeight,width:e.offsetWidth,x:r.x+parseFloat(t.paddingLeft),y:r.y+parseFloat(t.paddingTop)}},o.prototype.updateOutput=function(){var t=this,e=t.getElement("input","hex").value,o="rgb",n=(o=(o=(o=(o=(o+=t.options.alpha||t.options.alwaysAlpha?"a":"")+("("+t.getElement("input","r").value))+(","+t.getElement("input","g").value))+(","+t.getElement("input","b").value))+(t.options.alpha||t.options.alwaysAlpha?","+t.getElement("input","a").value:"")+")","hsl"),n=(n=(n=(n=(n+=t.options.alpha||t.options.alwaysAlpha?"a":"")+("("+t.getElement("input","h").value))+(","+t.getElement("input","s").value))+(","+t.getElement("input","l").value))+(t.options.alpha||t.options.alwaysAlpha?","+t.getElement("input","z").value:"")+")";t.maincolor=""===t.maincolor?e:t.maincolor;let i="";i="mixed"===t.options.output?(i=t.options.alpha?o:e,"var("===t.maincolor.substring(0,4).toLowerCase()?t.maincolor:i):"rgb"===t.options.output?o:"hsl"===t.options.output?n:e,t.$output.attr("value",i),t.$output.trigger("input")},o.prototype.eventChangeInput=function(t){t.preventDefault();t=t.currentTarget.value;this.maincolor=t,this.setPositionFromColor()},o.prototype.eventChangeOutput=function(t){t.preventDefault();var e=this,t=t.currentTarget.value,o=(e.$el.css("color",t),e.$el.find("input"));o.length&&o.attr("value",t),"function"==typeof e.options.onChange&&e.options.onChange.call(this,t,e)},o.prototype.eventClickElement=function(t){t.preventDefault(),t.stopPropagation();var e,t=this;t.$colorpicker.hasClass(t.options.opened)?t.$colorpicker.trigger("destroy"):((e=s(".poseidon-color-picker").not('[id="'+t.id+'"]')).length&&s.each(e,function(t,e){s(e).trigger("destroy")}),t.maincolor=t.getColor(),t.$colorpicker.hasClass(t.options.init)||(t.$container.append(t.$colorpicker),t.$colorpicker.addClass(t.options.init)),t._attach(),t.$colorpicker.addClass(t.options.opened),t.updateColorPickerPosition(),t.setPositionFromColor())},o.prototype.eventClickLabel=function(t){t.preventDefault(),t.stopPropagation();var e=this.$colorpicker.find("div.pos-cp-inputs"),t=(t=t.currentTarget.parentNode.className).replace(/pos-cp-inputs|pos-cp--|\s/gi,"");e.addClass("pos-cp--none"),("hex"===t?e.eq(1):"rgb"===t?e.eq(2):e.eq(0)).removeClass(this.options.hidden)},o.prototype.eventClickSwatch=function(t){t.preventDefault(),t.stopPropagation();let e=t.currentTarget.getAttribute("style").replace(/color:|;/gi,"");"currentcolor"===e.toLowerCase()&&(e=s(t.currentTarget).css("color")),this.maincolor=e,this.setPositionFromColor()},o.prototype.eventDestroyColorPicker=function(){this.$colorpicker.removeClass(this.options.opened),this._detach()},o.prototype.eventKeyDown=function(t){var e,o,n,i=this,a=t.key.toLowerCase();"escape"===a?i.$el.trigger("click"):(i.options.saturation||i.options.hue||i.options.alpha)&&(n={arrowup:{x:0,y:-1},arrowdown:{x:0,y:1},arrowleft:{x:-1,y:0},arrowright:{x:1,y:0}},-1!==Object.keys(n).indexOf(a))&&(t.preventDefault(),e=i.options.saturation?"saturation":i.options.hue?"hue":"alpha",t=t.shiftKey?10:1,o=+(e=i.getElement("pointer",e)).getAttribute("x")+n[a].x*t,n=+e.getAttribute("y")+n[a].y*t,o=o<0?0:o>i.areas.width?i.areas.width:o,n=n<0?0:n>i.areas.height?i.areas.height:n,e.style.left=o+"px",e.setAttribute("x",o),e.style.top=n+"px",e.setAttribute("y",n),i.setColorFromPosition())},o.prototype.eventMovePointer=function(t){t.preventDefault(),t.stopImmediatePropagation();var e=this,o=document.poseidonColorPicker.role,t=(e.updateColorPickerPosition(),e.getPointerPosition(t)),n=e.getElement("pointer",o),i=(i=t.x-e.areas.x)<0?0:i>e.areas.width?e.areas.width:i;n.style.left=i+"px",n.setAttribute("x",i);"saturation"===o&&(i=t.y-e.areas.y,i=(i+="body"!==e.options.container?e.$container[0].scrollTop:0)<0?0:i>e.areas.height?e.areas.height:i,n.style.top=i+"px",n.setAttribute("y",i)),e.setColorFromPosition()},o.prototype.hsv2rgb=function(t){var e=t.v/100,o=t.s/100*e,n=t.h/60,i=o*(1-Math.abs(n%2-1)),e=e-o,n=(o+=e,i+=e,Math.floor(n)%6),a=Math.round(255*[o,i,e,e,i,o][n]),r=Math.round(255*[i,o,o,i,e,e][n]),e=Math.round(255*[e,e,i,o,o,i][n]);return{r:a,g:r,b:e,a:void 0===t.a?1:t.a,hex:"#"+(16777216|e|r<<8|a<<16).toString(16).slice(1)}},o.prototype.hsv2hsl=function(t){var e=t.v/100,o=e*(1-t.s/100/2);let n=0;return 0<o&&o<1&&(n=Math.round((e-o)/Math.min(o,1-o)*100)),{h:t.h,s:n,l:Math.round(100*o),a:void 0===t.a?1:t.a}},o.prototype.rgb2hex=function(t,e){var o=t.r.toString(16),n=t.g.toString(16),i=t.b.toString(16);let a="";return o=t.r<16?"0"+o:o,n=t.g<16?"0"+n:n,i=t.b<16?"0"+i:i,e.alpha&&(t=255*(void 0===t.a?1:t.a)|0,a=t.toString(16),a="ff"!==(a=t<16?"0"+a:a)||e.alwaysAlpha?a:""),"#"+o+n+i+a},o.prototype.rgb2hsv=function(t){var e=t.r/255,o=t.g/255,n=t.b/255,i=Math.max(e,o,n),a=i-Math.min(e,o,n),r=i;let p=0,s=0;return a&&(p=i===e?(o-n)/a:p,p=i===o?2+(n-e)/a:p,p=i===n?4+(e-o)/a:p,s=i?a/i:s),{h:(p=Math.floor(60*p))<0?p+360:p,s:Math.round(100*s),v:Math.round(100*r),a:void 0===t.a?1:t.a}},o.prototype.str2rgb=function(t,e){"var("===t.substring(0,4).toLowerCase()&&(i=/^var\(([a-zA-Z0-9-]{1,})(.*)\)/i.exec(t),t=getComputedStyle(document.documentElement).getPropertyValue(i[1]));let o,n;var i=document.createElement("canvas").getContext("2d");return i.fillStyle="#000000",i.fillStyle=t,o=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i.exec(i.fillStyle),n=o?{r:+o[3],g:+o[4],b:+o[5],a:e.alpha?+o[6]:1}:{r:(o=i.fillStyle.replace("#","").match(/.{2}/g).map(t=>parseInt(t,16)))[0],g:o[1],b:o[2],a:1}},o.prototype._attach=function(){function t(t){document.poseidonColorPicker.role=o.getRole(t),n[document.poseidonColorPicker.role].on("mouseenter",i),n[document.poseidonColorPicker.role].on("mouseleave",a),n[document.poseidonColorPicker.role].on("mousemove",r),n[document.poseidonColorPicker.role].on("mouseup",p),o.eventMovePointer(t)}var o=this,e=s(document),n={alpha:o.$alpha,hue:o.$hue,saturation:o.$saturation};const i=function(t){e.off("mousemove",r),e.off("mouseup",p),n[document.poseidonColorPicker.role].on("mousemove",r),n[document.poseidonColorPicker.role].on("mouseup",p),o.eventMovePointer(t)},a=function(t){n[document.poseidonColorPicker.role].off("mousemove",r),n[document.poseidonColorPicker.role].off("mouseup",p),e.on("mousemove",r),e.on("mouseup",p),o.eventMovePointer(t)},r=function(t){o.eventMovePointer(t)},p=function(t){n[document.poseidonColorPicker.role].off("mouseenter",i),n[document.poseidonColorPicker.role].off("mouseleave",a),n[document.poseidonColorPicker.role].off("mousemove",r),n[document.poseidonColorPicker.role].off("mouseup",p),e.off("mousemove",r),e.off("mouseup",p),o.eventMovePointer(t),"function"==typeof o.options.onMouseUp&&o.options.onMouseUp.call(this,o.maincolor,o),document.poseidonColorPicker.role=null};o.$saturation.on("mousedown",t),o.$hue.on("mousedown",t),o.$alpha.on("mousedown",t),o.$preview.one("click",function(t){t.stopPropagation(),o.$colorpicker.trigger("destroy")}),e.on("mousedown",function(t){t.stopPropagation();var e=s(t.target);e.closest(".poseidon-color-picker").length||e.hasClass("poseidon-color-picker")||e.closest("."+o.options.element).length||e.hasClass(o.options.element)||(o.$colorpicker.trigger("destroy"),e.off(t))}),e.on("keydown",s.proxy(o.eventKeyDown,o))},o.prototype._detach=function(){var t=s(document);this.$saturation.off(),this.$hue.off(),this.$alpha.off(),t.off("keydown",this.eventKeyDown)};var e={init:function(t){var e;return!!this.length&&(e={container:"body",alpha:!0,hue:!0,inputs:!0,preview:!0,saturation:!0,toggleButtons:!0,alwaysAlpha:!1,defaultColor:"#ff0000",inline:!1,onChange:null,onMouseUp:null,output:"mixed",swatches:[]},this.each(function(){t&&s.extend(e,t),new o(s(this),e)}))}};s.fn.poseidonColorPicker=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(s.error("Method "+t+" does not exist on poseidonColorPicker"),!1):e.init.apply(this,arguments)}}(window.jQuery);